明白了——而且你现在给出的证据非常“干净”：

你说 还是没有 cookie

你贴的响应头 依旧完全没有 Set-Cookie

/api/auth/user 继续 401

这说明问题不是“cookie 被浏览器挡住了”（那种情况通常还能在 response headers 里看到 Set-Cookie，只是 Chrome 标注 blocked）。
你现在是：服务器根本没发 Set-Cookie（或被反代层直接剥掉了，但这更少见）。

所以我们要做一个很快的二分定位：

到底是：后端根本没生成 cookie / session
还是：Caddy/Nginx 把 Set-Cookie 吞了？

下面给你最短路径定位 + 修复。

先说结论：为什么“加了 session 配置”仍然没有 Set-Cookie？

express-session 在 saveUninitialized: false 的情况下，只有当这个请求里 session “被修改/写入”并且成功保存，它才会下发 Set-Cookie。

所以只要出现下面任一情况，就会“登录 200 但没 cookie”：

你的 /phone-login 里根本没有写 req.session.xxx = ...

写了，但写在 res.json(...) 之后（已经响应了）

写了，但 session store 保存失败（比如 Redis 没连上/权限错），你没注意到

session middleware 没有挂到该路由之前（路由先注册了，中间件后注册）

你同事改的那段只是“session 中间件配置”，不保证路由真的触发 set-cookie。

1 分钟二分定位：加一个“强制 Set-Cookie 的测试接口”

在后端临时加一个路由（只用于调试，用完删掉）：

app.get("/api/debug/set-cookie", (req, res) => {
  res.cookie("debug_cookie", "1", {
    httpOnly: false,
    secure: true,
    sameSite: "lax",
    path: "/",
  });
  res.json({ ok: true });
});


然后浏览器访问：

https://admin.yuejuapp.com/api/debug/set-cookie

看 Network → Response Headers 有没有 Set-Cookie: debug_cookie=1...

结果解释

✅ 有 Set-Cookie：说明 Caddy/Nginx 没吞 cookie，问题在 登录接口没有写/没保存 session。

❌ 没有 Set-Cookie：说明 反代层在剥掉 Set-Cookie（或者你命中的不是你以为的后端服务/路由根本没生效）。

这个测试非常关键，因为它直接把问题从“猜”变成“定罪”。

如果测试接口能 Set-Cookie（最常见情况）

那就直接修 /api/auth/phone-login：确保写 session，并强制保存再响应。

登录成功后这样写（关键是 req.session.save）：

req.session.userId = user.id;
req.session.isAdmin = true; // 如果你有权限判断

req.session.save((err) => {
  if (err) {
    console.error("session save failed:", err);
    return res.status(500).json({ message: "Session save failed" });
  }
  return res.json({ message: "Login successful", user: safeUser });
});


再去看 phone-login 的 response headers：应该会出现 Set-Cookie。

同时做一个“防漏”检查

在登录路由里临时加日志（看请求内 session id 有没有生成）：

console.log("session id:", req.sessionID);
console.log("session before:", req.session);


如果 req.sessionID 都没有，说明 session middleware 根本没覆盖到这条路由（中间件挂载顺序问题）。

如果测试接口也没 Set-Cookie（比较少见，但一针见血）

那就去检查 Caddy / Nginx 是否改写响应头：

Caddyfile / nginx 配置里有没有类似：

header_down -Set-Cookie

proxy_hide_header Set-Cookie（nginx）

或任何 header 指令把它删了

正常反代不会默认删 Set-Cookie，所以如果出现，十有八九是你配置里动过 headers。

你提到的“多了个不一样的 401”

Failed to load resource: the server responded with a status of 401 ()
这只是 Chrome 控制台对 401 的统一提示，不是新类型错误。根因还是：/api/auth/user 没收到认证信息（cookie/token）。